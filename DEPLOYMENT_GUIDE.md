# 🚀 Deployment Guide - Domy v Italii

Complete guide for deploying your Italian Real Estate platform to production with custom domain.

## 🏗️ **Architecture Overview**

```
domyvitalii.cz (Main Website)
├── api.domyvitalii.cz (Backend API)
├── admin.domyvitalii.cz (Admin Dashboard)
└── cdn.domyvitalii.cz (Static Assets - Optional)
```

## 🌐 **Recommended Hosting Strategy**

### **Option 1: Railway + Netlify (Recommended)**
- **Backend**: Railway (PostgreSQL + Node.js)
- **Frontend**: Netlify (Static hosting)
- **Admin**: Netlify (React app)
- **Cost**: ~$15-25/month total

### **Option 2: Vercel + PlanetScale**
- **Backend**: Vercel (Serverless functions)
- **Database**: PlanetScale (MySQL)
- **Frontend**: Vercel (Static hosting)
- **Cost**: ~$10-20/month total

### **Option 3: DigitalOcean Droplet**
- **Everything**: Single VPS ($12/month)
- **More control, requires server management**

## 📋 **Step-by-Step Deployment**

### **Phase 1: Backend Deployment (Railway)**

#### 1. **Create Railway Account**
```bash
# Install Railway CLI
npm install -g @railway/cli

# Login to Railway
railway login
```

#### 2. **Deploy Backend**
```bash
cd backend

# Initialize Railway project
railway init

# Add PostgreSQL database
railway add postgresql

# Set environment variables
railway variables set NODE_ENV=production
railway variables set JWT_SECRET=your-super-secure-production-jwt-secret
railway variables set REFRESH_TOKEN_SECRET=your-refresh-token-secret
railway variables set ADMIN_EMAIL=admin@domyvitalii.cz
railway variables set ADMIN_PASSWORD=YourSecurePassword123!
railway variables set CLOUDINARY_CLOUD_NAME=your-cloudinary-name
railway variables set CLOUDINARY_API_KEY=your-cloudinary-key
railway variables set CLOUDINARY_API_SECRET=your-cloudinary-secret

# Deploy
railway up
```

#### 3. **Set Up Database**
```bash
# Run migrations
railway run npm run db:push

# Seed database
railway run npm run db:seed
```

#### 4. **Configure Custom Domain**
- Go to Railway dashboard
- Navigate to your project → Settings → Domains
- Add custom domain: `api.domyvitalii.cz`
- Update your DNS records as instructed

### **Phase 2: Frontend Deployment (Netlify)**

#### 1. **Prepare Main Website**
```bash
# In your main website folder
# Create _redirects file for form handling
echo "/api/* https://api.domyvitalii.cz/api/:splat 200" > _redirects

# Create netlify.toml
cat > netlify.toml << EOF
[build]
  publish = "."

[[redirects]]
  from = "/api/*"
  to = "https://api.domyvitalii.cz/api/:splat"
  status = 200
  force = true

[build.environment]
  NODE_VERSION = "18"
EOF
```

#### 2. **Deploy to Netlify**
- Connect your GitHub repository to Netlify
- Set build settings:
  - Build command: (leave empty for static site)
  - Publish directory: `.` (root)
- Add custom domain: `domyvitalii.cz`

### **Phase 3: Admin Dashboard Deployment**

#### 1. **Build Admin Dashboard**
```bash
cd admin-dashboard

# Create environment file
cat > .env.production << EOF
VITE_API_URL=https://api.domyvitalii.cz/api
EOF

# Build for production
npm run build
```

#### 2. **Deploy Admin to Netlify**
- Create new Netlify site
- Upload `dist` folder or connect to GitHub
- Set custom domain: `admin.domyvitalii.cz`
- Configure redirects for SPA:

```toml
# netlify.toml for admin dashboard
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
```

## 🔧 **Domain Configuration**

### **DNS Records Setup**

Add these DNS records to your domain provider:

```
Type    Name        Value                           TTL
A       @           [Netlify IP for main site]     3600
CNAME   www         domyvitalii.cz                  3600
CNAME   api         [Railway domain]               3600
CNAME   admin       [Netlify admin domain]         3600
```

### **SSL Certificates**
- Railway and Netlify provide automatic SSL
- Verify HTTPS is working for all subdomains

## 🔐 **Security Configuration**

### **Environment Variables Checklist**

#### Backend (Railway):
```env
NODE_ENV=production
DATABASE_URL=[Auto-generated by Railway]
JWT_SECRET=[Strong random string]
REFRESH_TOKEN_SECRET=[Strong random string]
ADMIN_EMAIL=admin@domyvitalii.cz
ADMIN_PASSWORD=[Strong password]
CLOUDINARY_CLOUD_NAME=[Your Cloudinary name]
CLOUDINARY_API_KEY=[Your Cloudinary key]
CLOUDINARY_API_SECRET=[Your Cloudinary secret]
ALLOWED_ORIGINS=https://domyvitalii.cz,https://admin.domyvitalii.cz
```

#### Frontend (Netlify):
```env
# No sensitive data in frontend!
```

#### Admin Dashboard:
```env
VITE_API_URL=https://api.domyvitalii.cz/api
```

## 📊 **External Services Setup**

### **1. Cloudinary (Image Storage)**
1. Create account at cloudinary.com
2. Get credentials from dashboard
3. Configure upload presets for security

### **2. Email Service (Optional)**
```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
FROM_EMAIL=noreply@domyvitalii.cz
```

### **3. Analytics (Optional)**
- Google Analytics
- Hotjar for user behavior
- Sentry for error tracking

## 🚀 **Deployment Checklist**

### **Pre-Deployment**
- [ ] Test all functionality locally
- [ ] Update API endpoints in frontend
- [ ] Set strong production passwords
- [ ] Configure CORS for production domains
- [ ] Test image uploads with Cloudinary
- [ ] Verify email functionality

### **Post-Deployment**
- [ ] Test login to admin dashboard
- [ ] Create sample property listing
- [ ] Test blog post creation
- [ ] Verify contact forms work
- [ ] Test responsive design on mobile
- [ ] Check page load speeds
- [ ] Verify SEO meta tags

## 🔄 **CI/CD Setup (Optional)**

### **Automatic Deployment**
```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [ main ]

jobs:
  deploy-backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to Railway
        run: |
          npm install -g @railway/cli
          railway login --token ${{ secrets.RAILWAY_TOKEN }}
          railway up --service backend
          
  deploy-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to Netlify
        run: |
          npm install -g netlify-cli
          netlify deploy --prod --dir=. --auth ${{ secrets.NETLIFY_TOKEN }}
```

## 💰 **Cost Breakdown**

### **Monthly Costs (Estimated)**

#### Railway + Netlify Setup:
- Railway Starter: $5/month (includes PostgreSQL)
- Railway Pro: $20/month (for production workloads)
- Netlify Pro: $19/month (for forms and advanced features)
- Cloudinary: Free tier (25GB storage, 25GB bandwidth)
- Domain: ~$15/year

**Total: $25-40/month + domain**

#### Vercel + PlanetScale:
- Vercel Pro: $20/month
- PlanetScale: $29/month (Scaler plan)
- Cloudinary: Free tier
- Domain: ~$15/year

**Total: $50/month + domain**

## 🛠️ **Maintenance & Updates**

### **Regular Tasks**
- Monitor error logs
- Update dependencies monthly
- Backup database weekly
- Review security alerts
- Monitor performance metrics

### **Database Backups**
```bash
# Railway automatic backups included
# For manual backup:
railway run pg_dump $DATABASE_URL > backup.sql
```

## 🆘 **Troubleshooting**

### **Common Issues**

#### CORS Errors:
```javascript
// Backend: Update ALLOWED_ORIGINS
ALLOWED_ORIGINS=https://domyvitalii.cz,https://admin.domyvitalii.cz
```

#### 404 on Admin Routes:
```toml
# Add to netlify.toml
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
```

#### Database Connection Issues:
```bash
# Check Railway logs
railway logs

# Verify DATABASE_URL
railway variables
```

#### Image Upload Failures:
- Verify Cloudinary credentials
- Check file size limits
- Confirm upload presets

## 📞 **Support Resources**

- **Railway**: railway.app/help
- **Netlify**: docs.netlify.com
- **Cloudinary**: cloudinary.com/documentation
- **Domain Issues**: Contact your domain provider

---

## 🎯 **Quick Start Commands**

```bash
# Deploy backend
cd backend && railway up

# Build and deploy admin
cd admin-dashboard && npm run build

# Update DNS records
# Point api.domyvitalii.cz to Railway
# Point admin.domyvitalii.cz to Netlify
# Point domyvitalii.cz to main site
```

Your Italian real estate platform will be live and ready for your team to use! 🏠🇮🇹 